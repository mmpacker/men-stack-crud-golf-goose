<%- include('../partials/header') %>

<main>
  <div class='wrapper'>
    <div class='container'>
      <div class='row mb-4'>
        <h1 id='pageTitle'><%= title %></h1>
      </div>
      <div class='row'>
        <div class='card mx-50' id='showCourseCard'>
          <div class='row'>
            <div class='col-md-7 my-2 justify-content-center'>
              <img src="https://upload.wikimedia.org/wikipedia/commons/b/be/Pebble_Beach_Golf_Links%2C_hole_7.jpg" id='showCourseImage' alt="">
            </div>
            <div class='col-md-5 my-4'>
              <div class='row'>
                <p id='showCourseName'><%= course.name %></p>
              </div>
              <div class='row mb-3'>
                <p id='showCourseLoc'><%= course.city %>, <%= course.state %></p>
              </div>
              <% let total = 0 %>
              <% course.reviews.forEach(r => { %>
                <% total += r.rating %> 
              <% }) %>
              <div class='row'>
                <p id='showCourseAvgRate'>Average User Rating: <%= (total / course.reviews.length).toFixed(2) %></p>
              </div>
              <div class='row'>
                <p id='showCoursePubBuilt'>Public?: <%= course.public ? 'Yes' : 'No'%> - Built: <%= course.yearBuilt %></p>
              </div>
              <div class='row mb-2'>
                <p id='showCourseRank'>Golf Magazine US Ranking: <%= course.usRank %></p>
              </div>
              <div class='row'>
                <p id='showCourseArch1'>Architects:</p>
              </div>
              <div class='row'>
                <p id='showCourseArch2'><%= course.architects %></p>
              </div>
            </div>
            
          </div>
          <div class='card-body'>
            <h5 class='card-title'><%= course.name %> </h5>
            <h6 class='card-title'><%= course.city %>, <%= course.state %></h6>
            <p class="card-text"></p>
              Average User Rating: <%= (total / course.reviews.length).toFixed(2) %>
            </p>
            <div class='align-self-end ml-auto'>
              <a href="/courses/<%= course._id %>/review" class="btn btn-primary float-right" id='right'>Reviews</a>
            </div>
            <div class='align-self-center mx-auto'>
              <a href="/courses/<%= course._id %>/edit" class="btn btn-warning" id='center'>Edit Details</a>
            </div>
            <div class='align-self-start mr-auto'>
            <% if (course.playedBy.some(u => {return u.email === user.email})) { %>
              <form
                action="/courses/<%= course._id %>/myPlayed?_method=DELETE"
                method="POST"
              >
            <% } else { %>
              <form action="/courses/<%= course._id %>/myPlayed" method="POST">
            <% } %>
              <input type="text" hidden name="name" value="<%= course.name %>">
              <input type="text" hidden name="imageUrl" value="<%= course.imageUrl %> ">
              <input type="text" hidden name="city" value="<%= course.city %>">
              <input type="text" hidden name="state" value="<%= course.state %>">
              <input type="number" hidden name="usRank" value="<%= course.usRank %>">
              <input type="boolean" hidden name="public" value="<%= course.public %>">
              <input type="number" hidden name="yearBuilt" value="<%= course.yearBuilt %>">
              <input type="text" hidden name="architects" value="<%= course.architects %>">
              <input type="text" hidden name="summary" value="<%= course.summary %>">
                <button class="btn btn-success float-left" id='left'>
                  <%= course.playedBy.some(u => {return u.email === user.email}) ? "Remove" : "Add" %>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<%- include('../partials/footer') %>